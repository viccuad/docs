<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-writing-policies/rego/intro-rego">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-56382716-13","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-rh="true">Kubewarden Â· Kubernetes Dynamic Admission at your fingertips</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.kubewarden.io/writing-policies/rego/intro-rego"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="description" content="Note well"><meta data-rh="true" property="og:description" content="Note well"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.kubewarden.io/writing-policies/rego/intro-rego"><link data-rh="true" rel="alternate" href="https://docs.kubewarden.io/writing-policies/rego/intro-rego" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.kubewarden.io/writing-policies/rego/intro-rego" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5eecb69e.css">
<link rel="preload" href="/assets/js/runtime~main.c0bb628d.js" as="script">
<link rel="preload" href="/assets/js/main.43579c1c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon-kubewarden.svg" alt="logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/icon-kubewarden.svg" alt="logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title"></b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link navbar__docs navbar__link--active" href="/">Docs</a><a href="https://github.com/kubewarden/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/tasks">Common Tasks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Common Tasks&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/writing-policies">Writing Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Writing Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/writing-policies/rust/intro-rust">Supported Languages</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writing-policies/rust/intro-rust">Rust</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writing-policies/go/intro-go">Go</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/writing-policies/rego/intro-rego">Rego</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/writing-policies/rego/intro-rego">Introduction to Rego</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/writing-policies/rego/builtin-support">Builtin Support</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writing-policies/swift">Swift</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/writing-policies/typescript">TypeScript</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/writing-policies/rego/open-policy-agent/intro">Supported Frameworks</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/distributing-policies">Distributing Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Distributing Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/testing-policies/intro">Testing Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operator-manual/intro">Operator Manual</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operator Manual&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">ð </a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Supported Languages</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Rego</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Introduction to Rego</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Rego</h1><blockquote><p><strong>Note well:</strong> Rego support has been introduced starting from these releases:</p><ul><li>kwctl: v0.2.0</li><li>policy-server: v0.2.0</li></ul></blockquote><p>The Rego language is a tailor made language designed to embrace
policies as
code. <a href="https://www.openpolicyagent.org/docs/latest/policy-language/" target="_blank" rel="noopener noreferrer">Rego</a>
is a language inspired by Datalog.</p><p>There are two ways of writing Rego policies as of today in order to
implement policies as code in Kubernetes: Open Policy Agent and
Gatekeeper.</p><p>While the next couple of sections detail how the two frameworks are different
even though the same language is used, if you&#x27;re more interested in the Kubewarden
implementation you may directly visit the framework-specific documentation we have linked below.</p><ul><li><a href="/writing-policies/rego/open-policy-agent/intro">Open Policy Agent</a></li><li><a href="/writing-policies/rego/gatekeeper/intro">Gatekeeper</a></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="one-language-two-frameworks">One language. Two frameworks<a class="hash-link" href="#one-language-two-frameworks" title="Direct link to heading">â</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="open-policy-agent">Open Policy Agent<a class="hash-link" href="#open-policy-agent" title="Direct link to heading">â</a></h3><p>Open Policy Agent is a project that allows you to implement policies
as code in any project. You can rely on Open Policy Agent for any
policy based check that you might require in your own application,
that will in turn execute the required Rego policies.</p><p>In this context, writing policies for Kubernetes is just another way
of exercising Open Policy Agent. By using Kubernetes admission
webhooks, it&#x27;s possible to evaluate requests using Open Policy Agent,
that will in turn execute the policies written in Rego.</p><p>Open Policy Agent has some optional integration with Kubernetes
through its <code>kube-mgmt</code> sidecar. When deployed on top of Kubernetes
and next to the Open Policy Agent server evaluating the Rego policies,
it is able to replicate the configured Kubernetes resources into Rego
-- so those Kubernetes resources are visible to all policies. It also
lets you define policies inside Kubernetes&#x27; ConfigMap objects. You can
read more about it on <a href="https://github.com/open-policy-agent/kube-mgmt" target="_blank" rel="noopener noreferrer">its project
page</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="gatekeeper">Gatekeeper<a class="hash-link" href="#gatekeeper" title="Direct link to heading">â</a></h3><p>Gatekeeper is very different from Open Policy Agent in this regard. It
is focused exclusively to be used in Kubernetes, and takes advantage
of that as much as it can, making some Kubernetes workflows easier
than Open Policy Agent in many cases.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="looking-at-the-differences">Looking at the differences<a class="hash-link" href="#looking-at-the-differences" title="Direct link to heading">â</a></h2><p>Both Open Policy Agent and Gatekeeper policies use Rego to describe
their policies as code. However, this is only one part of the
puzzle. Each solution has differences when it comes to writing real
policies in Rego, and we are going to look at those differences in the
next sections.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="entry-point">Entry point<a class="hash-link" href="#entry-point" title="Direct link to heading">â</a></h2><p>The entry point is the name of a rule within a package, and is the
rule to be invoked by the runtime when the policy is instantiated.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="current-limitations">Current limitations<a class="hash-link" href="#current-limitations" title="Direct link to heading">â</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="context-aware-policies">Context-aware policies<a class="hash-link" href="#context-aware-policies" title="Direct link to heading">â</a></h3><p>Context-aware policies are policies that don&#x27;t evaluate the input
request in isolation. They take other factors into account in order to
take a decision. For example, a policy that evaluates namespaced
resources and uses an annotation on the parent namespace to configure
something on the policy. Another example would be a policy that
evaluates <code>Ingress</code> resources, but that in order to take a decision
has the list of the already existing <code>Ingress</code> resources.</p><p>The concept of context-aware policies can also extend to custom
resources, so your policy might want to evaluate a request based on
currently persisted custom resources as well.</p><p>Both Open Policy Agent and Gatekeeper support context-aware
policies. Right now Kubewarden implements this functionality only for
policies written with the Kubewarden SDK. We have plans to fill this
gap, to allow Rego policies to be context-aware policies too.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="mutating-policies">Mutating policies<a class="hash-link" href="#mutating-policies" title="Direct link to heading">â</a></h3><p>Gatekeeper has support for mutating policies, but Kubewarden has not
yet implemented mutating policies with Gatekeeper compatibility. You
can use policies that use the Kubewarden SDK to write mutating
policies, but at the time of writing, you cannot run Gatekeeper
mutating policies in Kubewarden yet.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kubewarden/docs/edit/main/docs/writing-policies/rego/01-intro-rego.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-06-02T09:19:47.000Z">6/2/2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/writing-policies/go/distribute"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Distributing Policy</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/writing-policies/rego/builtin-support"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Builtin Support</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#one-language-two-frameworks" class="table-of-contents__link toc-highlight">One language. Two frameworks</a><ul><li><a href="#open-policy-agent" class="table-of-contents__link toc-highlight">Open Policy Agent</a></li><li><a href="#gatekeeper" class="table-of-contents__link toc-highlight">Gatekeeper</a></li></ul></li><li><a href="#looking-at-the-differences" class="table-of-contents__link toc-highlight">Looking at the differences</a></li><li><a href="#entry-point" class="table-of-contents__link toc-highlight">Entry point</a></li><li><a href="#current-limitations" class="table-of-contents__link toc-highlight">Current limitations</a><ul><li><a href="#context-aware-policies" class="table-of-contents__link toc-highlight">Context-aware policies</a></li><li><a href="#mutating-policies" class="table-of-contents__link toc-highlight">Mutating policies</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 SUSE Rancher. All Rights Reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c0bb628d.js"></script>
<script src="/assets/js/main.43579c1c.js"></script>
</body>
</html>