<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tasksDir/psp-migration">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-56382716-13","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>


<link rel="search" type="application/opensearchdescription+xml" title="Kubewarden" href="/opensearch.xml"><title data-rh="true">Kubewarden</title><meta data-rh="true" property="og:title" content="Kubewarden"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.kubewarden.io/tasksDir/psp-migration"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="description" content="With the removal of PodSecurityPolicy"><meta data-rh="true" property="og:description" content="With the removal of PodSecurityPolicy"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.kubewarden.io/tasksDir/psp-migration"><link data-rh="true" rel="alternate" href="https://docs.kubewarden.io/tasksDir/psp-migration" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.kubewarden.io/tasksDir/psp-migration" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HJOF663D19-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.080c2ef5.css">
<link rel="preload" href="/assets/js/runtime~main.359aecf6.js" as="script">
<link rel="preload" href="/assets/js/main.c010f57b.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/icon-kubewarden.svg" alt="logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/icon-kubewarden.svg" alt="logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Kubewarden, a CNCF Sandbox Project</b></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__docs navbar__link--active" href="/">Docs</a><a href="https://github.com/kubewarden/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link navbar__github btn btn-secondary icon-github">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/tasks">Common Tasks</a><button aria-label="Toggle the collapsible sidebar category &#x27;Common Tasks&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tasksDir/mutating-policies">Mutating Policies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tasksDir/psp-migration">PSP Migration</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/architecture">Architecture</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/writing-policies">Writing Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Writing Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/distributing-policies">Distributing Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Distributing Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/testing-policies/intro">Testing Policies</a><button aria-label="Toggle the collapsible sidebar category &#x27;Testing Policies&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/operator-manual/intro">Operator Manual</a><button aria-label="Toggle the collapsible sidebar category &#x27;Operator Manual&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/security/intro">Security</a><button aria-label="Toggle the collapsible sidebar category &#x27;Security&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/tasks"><span itemprop="name">Common Tasks</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">PSP Migration</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>PSP Migration</h1><p>With the removal of <a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/" target="_blank" rel="noopener noreferrer">PodSecurityPolicy</a>
in Kubernetes v1.25, you can leverage Kubewarden for admission control on your Kubernetes clusters.
Contrasting with the PSPs, Kubewarden has separate policies to achieve the same goal. Therefore, each Kubewarden policy could be likened to a different
configuration within the spec of a PSP. A mapping of the PSP configuration fields to their respective policies can be found below
in the <a href="#mapping-kuberwarden-policies-to-psp-fields">mapping table</a>. Therefore, the operators have more granular control
of the configuration they want to apply in their clusters. If they want to apply part of the PSP security checks it
is not necessary to define the configurations related to the other fields.</p><p>Once you have the Kubewarden instance running, it&#x27;s time to deploy some policies to replace the <code>PodSecurityPolicy</code> object. Start by listing
the PSPs in use. For the sake of this example, the following enforcements have been considered:</p><ul><li>a PSP disabling privileged escalation</li><li>privileged containers</li><li>blocking pods running as root</li><li>forcing a particular user group</li><li>blocking host namespaces</li><li>allowing pod to use the port 443 only</li></ul><p>The yaml definition of the aforementioned PSP would look like the below:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policy/v1beta1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: PodSecurityPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: restricted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  allowPrivilegeEscalation: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  runAsUser:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rule: MustRunAsNonRoot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  supplementalGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rule: MustRunAs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ranges:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - min: 1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        max: 65535</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  privileged: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostNetwork: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostIPC: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostPID: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostPorts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - min: 443</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      max: 443</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s create Kubewarden policies to achieve the same goal. One thing that you need to know about Kubewarden policies is that every rule will be enforced by a separate policy. In our example, individual policies will be required for the enforcement of user and group configuration, host namespaces,  privileged escalation, and for the privileged container configuration.</p><p>Let&#x27;s start with blocking container escalation. For that you can deploy a policy as shown below:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1alpha2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-allowprivilegeescalation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/allow-privilege-escalation-psp:v0.1.11</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    default_allow_privilege_escalation: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you notice, we have specified <code>default_allow_privilege_escalation</code> to assume a value <code>false</code>. Once this policy starts running, it will restrict pods trying to run with more privileges than the parent container by default.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    securityContext:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      allowPrivilegeEscalation: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: sidecar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: sidecar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error from server: error when creating &quot;STDIN&quot;: admission webhook &quot;clusterwide-psp-allowprivilegeescalation.kubewarden.admission&quot; denied the request: one of the containers has privilege escalation enabled</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, to enforce the user and groups configuration, you can use the <a href="https://github.com/kubewarden/user-group-psp-policy" target="_blank" rel="noopener noreferrer">user-group-psp policy</a></p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1alpha2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-usergroup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/user-group-psp:v0.2.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    run_as_user:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      rule: MustRunAsNonRoot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    supplemental_groups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      rule: MustRunAs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ranges:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - min: 1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          max: 65535</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notice the policy is configured as <code>mutation: true</code>. This is required because the policy will add <a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#users-and-groups" target="_blank" rel="noopener noreferrer">supplementalGroups</a> when the user does not define them.</p><p>So, now users cannot deploy pods running as root:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    securityContext:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      runAsNonRoot: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      runAsUser: 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error from server: error when creating &quot;STDIN&quot;: admission webhook &quot;clusterwide-psp-usergroup-fb836.kubewarden.admission&quot; denied the request: RunAsNonRoot should be set to true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    securityContext:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      runAsNonRoot: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      runAsUser: 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error from server: error when creating &quot;STDIN&quot;: admission webhook &quot;clusterwide-psp-usergroup-fb836.kubewarden.admission&quot; denied the request: Invalid user ID: cannot run container with root ID (0)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Also, the example below also demonstrates the addition of a <a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#users-and-groups" target="_blank" rel="noopener noreferrer">Supplemental group</a>, despite it not being defined by us.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pod/nginx created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl get pods -o json nginx | jq &quot;.spec.securityContext&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;supplementalGroups&quot;: [</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    10000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To replace the PSP configuration that blocks privileged containers, it&#x27;s necessary to deploy the <a href="https://github.com/kubewarden/pod-privileged-policy" target="_blank" rel="noopener noreferrer">pod-privileged policy</a>. This policy does not require any settings. Once running, it will block privileged pods.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1alpha2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-privileged</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/pod-privileged:v0.1.10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings: null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To test the policy, we can try running a pod with privileged configuration enabled:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    securityContext:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      privileged: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: sleeping-sidecar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: alpine</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    command: [&quot;sleep&quot;, &quot;1h&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error from server: error when creating &quot;STDIN&quot;: admission webhook &quot;clusterwide-psp-privileged.kubewarden.admission&quot; denied the request: User &#x27;system:admin&#x27; cannot schedule privileged containers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To complete the PSP migration exercise, it&#x27;s necessary to disable host namespace sharing.
To do that, we shall be using the <a href="https://github.com/kubewarden/host-namespaces-psp-policy" target="_blank" rel="noopener noreferrer"><code>host-namespace-psp</code> policy</a>.
It allows the cluster administrator to block IPC, PID, and network namespaces individually and set the ports
that the pods can be exposed on the host IP.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1alpha2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-hostnamespaces</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/host-namespaces-psp:v0.1.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allow_host_ipc: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allow_host_pid: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allow_host_ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - min: 443</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        max: 443</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allow_host_network: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again, let&#x27;s validate the policy. The pod should not be able to share host namespaces:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostIPC: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostNetwork: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostPID: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: sleeping-sidecar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: alpine</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    command: [&quot;sleep&quot;, &quot;1h&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error from server: error when creating &quot;STDIN&quot;: admission webhook &quot;clusterwide-psp-hostnamespaces.kubewarden.admission&quot; denied the request: Pod has IPC enabled, but this is not allowed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostIPC: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostNetwork: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostPID: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: sleeping-sidecar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: alpine</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    command: [&quot;sleep&quot;, &quot;1h&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error from server: error when creating &quot;STDIN&quot;: admission webhook &quot;clusterwide-psp-hostnamespaces.kubewarden.admission&quot; denied the request: Pod has host network enabled, but this is not allowed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostIPC: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostNetwork: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hostPID: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: sleeping-sidecar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: alpine</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    command: [&quot;sleep&quot;, &quot;1h&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error from server: error when creating &quot;STDIN&quot;: admission webhook &quot;clusterwide-psp-hostnamespaces.kubewarden.admission&quot; denied the request: Pod has host PID enabled, but this is not allowed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The pod should be only able to expose the port 443 and should throw an error when other port numbers are configured against the hostPort section.</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: nginx</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    imagePullPolicy: IfNotPresent</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - containerPort: 80</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hostPort: 80</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - name: sleeping-sidecar</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    image: alpine</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    command: [&quot;sleep&quot;, &quot;1h&quot;]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error from server: error when creating &quot;STDIN&quot;: admission webhook &quot;clusterwide-psp-hostnamespaces.kubewarden.admission&quot; denied the request: Pod is using unallowed host ports in containers</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="mapping-kuberwarden-policies-to-psp-fields">Mapping Kuberwarden policies to PSP fields<a class="hash-link" href="#mapping-kuberwarden-policies-to-psp-fields" title="Direct link to heading">​</a></h2><p>The following table show which Kubewarden policy can be used to replace each PSP configuration</p><table><thead><tr><th>PSP field</th><th>Kubewarden equivalent policy</th></tr></thead><tbody><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#privileged" target="_blank" rel="noopener noreferrer">privileged</a></td><td><a href="https://github.com/kubewarden/pod-privileged-policy" target="_blank" rel="noopener noreferrer">pod-privileged-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#host-namespaces" target="_blank" rel="noopener noreferrer">hostPID</a></td><td><a href="https://github.com/kubewarden/host-namespaces-psp-policy" target="_blank" rel="noopener noreferrer">host-namespaces-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#host-namespaces" target="_blank" rel="noopener noreferrer">hostIPC</a></td><td><a href="https://github.com/kubewarden/host-namespaces-psp-policy" target="_blank" rel="noopener noreferrer">host-namespaces-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#host-namespaces" target="_blank" rel="noopener noreferrer">hostNetwork</a></td><td><a href="https://github.com/kubewarden/host-namespaces-psp-policy" target="_blank" rel="noopener noreferrer">host-namespaces-psp-polic</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#host-namespaces" target="_blank" rel="noopener noreferrer">hostPorts</a></td><td><a href="https://github.com/kubewarden/host-namespaces-psp-policy" target="_blank" rel="noopener noreferrer">host-namespaces-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#volumes-and-file-systems" target="_blank" rel="noopener noreferrer">volumes</a></td><td><a href="https://github.com/kubewarden/volumes-psp-policy" target="_blank" rel="noopener noreferrer">volumes-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#volumes-and-file-systems" target="_blank" rel="noopener noreferrer">allowedHostPaths</a></td><td><a href="https://github.com/kubewarden/hostpaths-psp-policy" target="_blank" rel="noopener noreferrer">hostpaths-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#volumes-and-file-systems" target="_blank" rel="noopener noreferrer">readOnlyRootFilesystem</a></td><td><a href="https://github.com/kubewarden/readonly-root-filesystem-psp-policy" target="_blank" rel="noopener noreferrer">readonly-root-filesystem-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#volumes-and-file-systems" target="_blank" rel="noopener noreferrer">fsgroup</a></td><td><a href="https://github.com/kubewarden/allowed-fsgroups-psp-policy" target="_blank" rel="noopener noreferrer">allowed-fsgroups-psp-policy </a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#flexvolume-drivers" target="_blank" rel="noopener noreferrer">allowedFlexVolumes</a></td><td><a href="https://github.com/kubewarden/flexvolume-drivers-psp-policy" target="_blank" rel="noopener noreferrer">flexvolume-drivers-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#users-and-groups" target="_blank" rel="noopener noreferrer">runAsUser</a></td><td><a href="https://github.com/kubewarden/user-group-psp-policy" target="_blank" rel="noopener noreferrer">user-group-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#users-and-groups" target="_blank" rel="noopener noreferrer">runAsGroup</a></td><td><a href="https://github.com/kubewarden/user-group-psp-policy" target="_blank" rel="noopener noreferrer">user-group-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#users-and-groups" target="_blank" rel="noopener noreferrer">supplementalGroups</a></td><td><a href="https://github.com/kubewarden/user-group-psp-policy" target="_blank" rel="noopener noreferrer">user-group-psp-policy </a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#privilege-escalation" target="_blank" rel="noopener noreferrer">allowPrivilegeEscalation</a></td><td><a href="https://github.com/kubewarden/allow-privilege-escalation-psp-policy" target="_blank" rel="noopener noreferrer">allow-privilege-escalation-psp-policy </a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#privilege-escalation" target="_blank" rel="noopener noreferrer">defaultAllowPrivilegeEscalation</a></td><td><a href="https://github.com/kubewarden/allow-privilege-escalation-psp-policy" target="_blank" rel="noopener noreferrer">allow-privilege-escalation-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#capabilities" target="_blank" rel="noopener noreferrer">allowedCapabilities</a></td><td><a href="https://github.com/kubewarden/capabilities-psp-policy" target="_blank" rel="noopener noreferrer">capabilities-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#capabilities" target="_blank" rel="noopener noreferrer">defaultAddCapabilities</a></td><td><a href="https://github.com/kubewarden/capabilities-psp-policy" target="_blank" rel="noopener noreferrer">capabilities-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#capabilities" target="_blank" rel="noopener noreferrer">requiredDropCapabilities</a></td><td><a href="https://github.com/kubewarden/capabilities-psp-policy" target="_blank" rel="noopener noreferrer">capabilities-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#selinux" target="_blank" rel="noopener noreferrer">seLinux</a></td><td><a href="https://github.com/kubewarden/selinux-psp-policy" target="_blank" rel="noopener noreferrer">selinux-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#allowedprocmounttypes" target="_blank" rel="noopener noreferrer">allowedProcMountTypes</a></td><td><a href="https://github.com/kubewarden/allowed-proc-mount-types-psp-policy" target="_blank" rel="noopener noreferrer">allowed-proc-mount-types-psp-policy</a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#apparmor" target="_blank" rel="noopener noreferrer">apparmor</a></td><td><a href="https://github.com/kubewarden/apparmor-psp-policy" target="_blank" rel="noopener noreferrer">apparmor-psp-policy </a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#apparmor" target="_blank" rel="noopener noreferrer">seccomp</a></td><td><a href="https://github.com/kubewarden/seccomp-psp-policy" target="_blank" rel="noopener noreferrer">seccomp-psp-policy </a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#apparmor" target="_blank" rel="noopener noreferrer">forbiddenSysctls</a></td><td><a href="https://github.com/kubewarden/sysctl-psp-policy" target="_blank" rel="noopener noreferrer">sysctl-psp-policy </a></td></tr><tr><td><a href="https://kubernetes.io/docs/concepts/security/pod-security-policy/#apparmor" target="_blank" rel="noopener noreferrer">allowedUnsafeSysctls</a></td><td><a href="https://github.com/kubewarden/sysctl-psp-policy" target="_blank" rel="noopener noreferrer">sysctl-psp-policy </a></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="psp-migration-script">PSP migration script<a class="hash-link" href="#psp-migration-script" title="Direct link to heading">​</a></h2><p>The Kubewarden team has written a script that leverages the migration tool written
by <a href="https://github.com/appvia/psp-migration" target="_blank" rel="noopener noreferrer">AppVia</a>, to migrate PSP
automatically. The tool is capable of reading PSPs YAML and generate the equivalent
policies in many different policy engines. Therefore, our simple script will migrate
your PSPs to the equivalent Kuberwarden policies.</p><p>The script is available in the <a href="https://github.com/kubewarden/utils/blob/main/scripts/psp-to-kubewarden" target="_blank" rel="noopener noreferrer">utils repository</a>
in the Kubewarden GitHub organization. It&#x27;s quite simple. It will download the
migration tool in the working directory and run it over all your PSPs printing
the equivalent Kuberwarden policies definition in the standard output. Therefore,
users can redirect the content to a file or to <code>kubectl</code> directly.</p><p>The script will migrate the PSPs defined in <code>kubectl</code> default context.
The Kubewarden policies will be printed to stdout. Thus, the users can
apply it directly or save it for further inspection.  Let&#x27;s take a look at an example:</p><p>In a cluster with the PSP blocking access to host namespaces, blocking privileged containers, not allowing privilege escalation, dropping all containers capabilities, listing the allowed volume types, defining the allowed user and groups to be used, controling the supplemental group applied to volumes and forcing containers to run in a read-only root filesystem:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> policy/v1beta1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> PodSecurityPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> restricted</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hostNetwork</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hostIPC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hostPID</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hostPorts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">min</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8080</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">privileged</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Required to prevent escalations to root.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">requiredDropCapabilities</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> ALL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Allow core volume types.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;configMap&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;emptyDir&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;projected&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;secret&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;downwardAPI&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Assume that ephemeral CSI drivers &amp; persistentVolumes set up by the cluster admin are safe to use.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;csi&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;persistentVolumeClaim&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;ephemeral&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">runAsUser</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Require the container to run without root privileges.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">rule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MustRunAsNonRoot&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">seLinux</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># This policy assumes the nodes are using AppArmor rather than SELinux.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">rule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;RunAsAny&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">supplementalGroups</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">rule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MustRunAs&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ranges</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Forbid adding the root group.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">min</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">65535</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">fsGroup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">rule</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;MustRunAs&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ranges</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Forbid adding the root group.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token key atrule">min</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">65535</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The equivalent Kubewarden policies can be applied directly to a cluster with
Kubewarden installed using the following command:</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ./psp-to-kubewarden | kubectl apply -f -</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Warning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Warning: policy/v1beta1 PodSecurityPolicy is deprecated in v1.21+, unavailable in v1.25+</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">clusteradmissionpolicy.policies.kubewarden.io/psp-privileged-82bf2 created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">clusteradmissionpolicy.policies.kubewarden.io/psp-readonlyrootfilesystem-b4a55 created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">clusteradmissionpolicy.policies.kubewarden.io/psp-hostnamespaces-a25a2 created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">clusteradmissionpolicy.policies.kubewarden.io/psp-volumes-cee05 created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">clusteradmissionpolicy.policies.kubewarden.io/psp-capabilities-34d8e created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">clusteradmissionpolicy.policies.kubewarden.io/psp-usergroup-878b0 created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">clusteradmissionpolicy.policies.kubewarden.io/psp-fsgroup-3b08e created</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">clusteradmissionpolicy.policies.kubewarden.io/psp-defaultallowprivilegeescalation-b7e87 created</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If users want to inspect the policies before applying, it&#x27;s possible to redirect
the content to a file or review it directly in the console</p><div class="language-console codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-console codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ./psp-to-kubewarden &gt; policies.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cat policies.yaml</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-privileged-82bf2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/pod-privileged:v0.1.10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings: null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-readonlyrootfilesystem-b4a55</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/readonly-root-filesystem-psp:v0.1.3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings: null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-hostnamespaces-a25a2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/host-namespaces-psp:v0.1.2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allow_host_ipc: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allow_host_pid: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allow_host_ports:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - max: 8080</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        min: 80</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allow_host_network: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-volumes-cee05</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/volumes-psp:v0.1.6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allowedTypes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - configMap</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - emptyDir</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - projected</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - secret</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - downwardAPI</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - csi</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - persistentVolumeClaim</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - ephemeral</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-capabilities-34d8e</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/capabilities-psp:v0.1.9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    allowed_capabilities: []</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    required_drop_capabilities:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - ALL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-usergroup-878b0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/user-group-psp:v0.2.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    run_as_user:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      rule: MustRunAsNonRoot</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    supplemental_groups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ranges:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - max: 65535</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          min: 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      rule: MustRunAs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-fsgroup-3b08e</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: registry://ghcr.io/kubewarden/policies/allowed-fsgroups-psp:v0.1.4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ranges:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      - max: 65535</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        min: 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rule: MustRunAs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">apiVersion: policies.kubewarden.io/v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">kind: ClusterAdmissionPolicy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name: psp-defaultallowprivilegeescalation-b7e87</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  module: &gt;-</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    registry://ghcr.io/kubewarden/policies/allow-privilege-escalation-psp:v0.1.11</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rules:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    - apiGroups:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - &quot;&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      apiVersions:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      resources:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - pods</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      operations:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - CREATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        - UPDATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  mutating: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  settings:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    default_allow_privilege_escalation: false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>The policy names are generated by the PSP migration tool.
You may want to change the name to something more meaningful.</p></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>This script works only in Linux x86_64 machines.</p></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/kubewarden/docs/edit/main/docs/tasksDir/psp-migration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-10-11T10:04:32.000Z">Oct 11, 2022</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tasksDir/mutating-policies"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Mutating Policies</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/architecture"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Architecture</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mapping-kuberwarden-policies-to-psp-fields" class="table-of-contents__link toc-highlight">Mapping Kuberwarden policies to PSP fields</a></li><li><a href="#psp-migration-script" class="table-of-contents__link toc-highlight">PSP migration script</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Kubewarden Project Authors. All rights reserved. The Linux Foundation has registered trademarks and uses trademarks.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.359aecf6.js"></script>
<script src="/assets/js/main.c010f57b.js"></script>
</body>
</html>