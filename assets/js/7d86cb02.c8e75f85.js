"use strict";(self.webpackChunkkubewarden_docusaurus=self.webpackChunkkubewarden_docusaurus||[]).push([[8715],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)n=l[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var d=r.createContext({}),c=function(e){var t=r.useContext(d),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},s=function(e){var t=c(e.components);return r.createElement(d.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,l=e.originalType,d=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),u=c(n),h=a,m=u["".concat(d,".").concat(h)]||u[h]||p[h]||l;return n?r.createElement(m,o(o({ref:t},s),{},{components:n})):r.createElement(m,o({ref:t},s))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var l=n.length,o=new Array(l);o[0]=u;var i={};for(var d in t)hasOwnProperty.call(t,d)&&(i[d]=t[d]);i.originalType=e,i.mdxType="string"==typeof e?e:a,o[1]=i;for(var c=2;c<l;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6444:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>c});var r=n(3117),a=(n(7294),n(3905));const l={sidebar_label:"Rancher Fleet",title:""},o="Managing Kubewarden with Rancher Fleet",i={unversionedId:"operator-manual/Rancher-Fleet",id:"operator-manual/Rancher-Fleet",title:"",description:"The Kubewarden Helm charts, like other Helm charts, can be managed via [Rancher",source:"@site/docs/operator-manual/Rancher-Fleet.md",sourceDirName:"operator-manual",slug:"/operator-manual/Rancher-Fleet",permalink:"/operator-manual/Rancher-Fleet",draft:!1,editUrl:"https://github.com/kubewarden/docs/edit/main/docs/operator-manual/Rancher-Fleet.md",tags:[],version:"current",lastUpdatedAt:1673357193,formattedLastUpdatedAt:"Jan 10, 2023",frontMatter:{sidebar_label:"Rancher Fleet",title:""},sidebar:"docs",previous:{title:"Installation",permalink:"/operator-manual/airgap/install"},next:{title:"Security",permalink:"/security/intro"}},d={},c=[{value:"Installing",id:"installing",level:3},{value:"Removing",id:"removing",level:3},{value:"Example",id:"example",level:3}],s={toc:c};function p(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"managing-kubewarden-with-rancher-fleet"},"Managing Kubewarden with Rancher Fleet"),(0,a.kt)("p",null,"The Kubewarden Helm charts, like other Helm charts, can be managed via ",(0,a.kt)("a",{parentName:"p",href:"https://fleet.rancher.io/"},"Rancher\nFleet"),". Rancher Fleet uses Kubernetes CRDs to define\na GitOps approach for managing Kubernetes clusters. It does this by defining\nFleet Bundles."),(0,a.kt)("h3",{id:"installing"},"Installing"),(0,a.kt)("p",null,"The Kubewarden charts are normal charts, and they have defined dependencies that\nneed to be ready before the dependent chart is deployed:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"First, install ",(0,a.kt)("inlineCode",{parentName:"li"},"cert-manager"),", as it is needed for the Kubewarden stack default config."),(0,a.kt)("li",{parentName:"ul"},"Second, install ",(0,a.kt)("inlineCode",{parentName:"li"},"kubewarden-crds"),", as it is needed for the rest of Kubewarden charts."),(0,a.kt)("li",{parentName:"ul"},"Third, install ",(0,a.kt)("inlineCode",{parentName:"li"},"kubewarden-controller"),", as it is needed by ",(0,a.kt)("inlineCode",{parentName:"li"},"kubewarden-defaults"),"."),(0,a.kt)("li",{parentName:"ul"},"Fourth, install ",(0,a.kt)("inlineCode",{parentName:"li"},"kubewarden-defaults"),".")),(0,a.kt)("p",null,"On Rancher Fleet, one can codify the chart dependencies using\n",(0,a.kt)("a",{parentName:"p",href:"https://fleet.rancher.io/gitrepo-structure#fleetyaml"},(0,a.kt)("inlineCode",{parentName:"a"},"dependsOn")," in the ",(0,a.kt)("em",{parentName:"a"},"fleet.yaml")," file"),"."),(0,a.kt)("p",null,"At the time of writing and by how Rancher Fleet works, one may see transient\nerrors until the charts are ready, such as:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ErrApplied(1) [Cluster fleet-local/local: dependent bundle(s) are not ready:\n[kubewarden-example-helm-kubewarden-controller]]\n")),(0,a.kt)("p",null,"These errors don't signify a problem, and once each chart has\nfinished deploying, they will be gone."),(0,a.kt)("h3",{id:"removing"},"Removing"),(0,a.kt)("p",null,"Uninstalling CRDs automatically is normally not supported in any tooling, and\nRancher Fleet is no exception."),(0,a.kt)("p",null,"If you want to perform a correct removal, make sure to remove first the Bundle\nfor ",(0,a.kt)("inlineCode",{parentName:"p"},"kubewarden-defaults")," from the cluster, then ",(0,a.kt)("inlineCode",{parentName:"p"},"kubewarden-controller"),", and\nlast, ",(0,a.kt)("inlineCode",{parentName:"p"},"kubewarden-crds"),"."),(0,a.kt)("p",null,"When removing blindly the GitRepo, all 3 Kubewarden charts get removed at once.\nThis means the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubewarden-crds")," chart gets removed."),(0,a.kt)("p",null,"Kubewarden uses a pre-delete helm hook job in ",(0,a.kt)("inlineCode",{parentName:"p"},"kubewarden-controller")," chart that\ndeletes the default policy-server. This pre-delete hook is needed because we\nneed to vacate the webhooks of the policies (this is true any Policy Engine)\nbefore deleting the PolicyServer, or the cluster will have webhooks for\npolicies, but no policies instatiated, and will reject everything and be in a\nfailed state."),(0,a.kt)("p",null,"Removing the GitRepo and hence the ",(0,a.kt)("inlineCode",{parentName:"p"},"kubewarden-crds")," chart at the same time as\nthe ",(0,a.kt)("inlineCode",{parentName:"p"},"kubewarden-controller")," chart will make the pre-delete hook job to fail, and\nthe removal to be incomplete, leaving leftovers in the cluster."),(0,a.kt)("h3",{id:"example"},"Example"),(0,a.kt)("p",null,"Have a look at ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/kubewarden/fleet-example"},"github.com/kubewarden/fleet-example"),"\nfor an example of Fleet Bundle definitions."))}p.isMDXComponent=!0}}]);